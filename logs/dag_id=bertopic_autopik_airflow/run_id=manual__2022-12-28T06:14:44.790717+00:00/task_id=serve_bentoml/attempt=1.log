[2022-12-28T06:23:54.193+0000] {taskinstance.py:1165} INFO - Dependencies all met for <TaskInstance: bertopic_autopik_airflow.serve_bentoml manual__2022-12-28T06:14:44.790717+00:00 [queued]>
[2022-12-28T06:23:54.206+0000] {taskinstance.py:1165} INFO - Dependencies all met for <TaskInstance: bertopic_autopik_airflow.serve_bentoml manual__2022-12-28T06:14:44.790717+00:00 [queued]>
[2022-12-28T06:23:54.206+0000] {taskinstance.py:1362} INFO - 
--------------------------------------------------------------------------------
[2022-12-28T06:23:54.206+0000] {taskinstance.py:1363} INFO - Starting attempt 1 of 1
[2022-12-28T06:23:54.206+0000] {taskinstance.py:1364} INFO - 
--------------------------------------------------------------------------------
[2022-12-28T06:23:54.223+0000] {taskinstance.py:1383} INFO - Executing <Task(BashOperator): serve_bentoml> on 2022-12-28 06:14:44.790717+00:00
[2022-12-28T06:23:54.230+0000] {standard_task_runner.py:54} INFO - Started process 1026 to run task
[2022-12-28T06:23:54.233+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'bertopic_autopik_***', 'serve_bentoml', 'manual__2022-12-28T06:14:44.790717+00:00', '--job-id', '25', '--raw', '--subdir', 'DAGS_FOLDER/bertopic_autopik_***.py', '--cfg-path', '/tmp/tmp4jj7emjg']
[2022-12-28T06:23:54.234+0000] {standard_task_runner.py:83} INFO - Job 25: Subtask serve_bentoml
[2022-12-28T06:23:54.235+0000] {dagbag.py:525} INFO - Filling up the DagBag from /opt/***/dags/bertopic_autopik_***.py
[2022-12-28T06:24:05.518+0000] {warnings.py:109} WARNING - /home/***/.local/lib/python3.8/site-packages/***/configuration.py:545: DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
  option = self._get_environment_variables(deprecated_key, deprecated_section, key, section)

[2022-12-28T06:24:05.585+0000] {task_command.py:384} INFO - Running <TaskInstance: bertopic_autopik_airflow.serve_bentoml manual__2022-12-28T06:14:44.790717+00:00 [running]> on host 01844bb5aa3c
[2022-12-28T06:24:05.663+0000] {taskinstance.py:1590} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_EMAIL=hojun.seo@pikurate.com
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=bertopic_autopik_***
AIRFLOW_CTX_TASK_ID=serve_bentoml
AIRFLOW_CTX_EXECUTION_DATE=2022-12-28T06:14:44.790717+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=manual__2022-12-28T06:14:44.790717+00:00
[2022-12-28T06:24:05.664+0000] {subprocess.py:63} INFO - Tmp dir root location: 
 /tmp
[2022-12-28T06:24:05.664+0000] {subprocess.py:75} INFO - Running command: ['/bin/bash', '-c', ' \n            fuser -k 7171/tcp; bentoml serve -p 7171 bertopic_autopik_bento:latest --production\n        ']
[2022-12-28T06:24:05.698+0000] {subprocess.py:86} INFO - Output:
[2022-12-28T06:24:33.356+0000] {subprocess.py:93} INFO - 2022-12-28T06:24:33+0000 [INFO] [cli] Environ for worker 0: set CUDA_VISIBLE_DEVICES to 0
[2022-12-28T06:24:33.381+0000] {subprocess.py:93} INFO - 2022-12-28T06:24:33+0000 [INFO] [cli] Prometheus metrics for HTTP BentoServer from "bertopic_autopik_bento:latest" can be accessed at http://localhost:7171/metrics.
[2022-12-28T06:24:34.806+0000] {subprocess.py:93} INFO - 2022-12-28T06:24:34+0000 [ERROR] [cli] Exception in callback <bound method Arbiter.manage_watchers of <circus.arbiter.Arbiter object at 0x7f8bc073ca00>>
[2022-12-28T06:24:34.806+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2022-12-28T06:24:34.806+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/circus/util.py", line 1126, in _run
[2022-12-28T06:24:34.807+0000] {subprocess.py:93} INFO -     val = self.callback()
[2022-12-28T06:24:34.807+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/circus/util.py", line 1038, in wrapper
[2022-12-28T06:24:34.807+0000] {subprocess.py:93} INFO -     raise ConflictError("arbiter is already running %s command"
[2022-12-28T06:24:34.807+0000] {subprocess.py:93} INFO - circus.exc.ConflictError: arbiter is already running arbiter_start_watchers command
[2022-12-28T06:24:35.823+0000] {subprocess.py:93} INFO - 2022-12-28T06:24:35+0000 [ERROR] [cli] Exception in callback <bound method Arbiter.manage_watchers of <circus.arbiter.Arbiter object at 0x7f8bc073ca00>>
[2022-12-28T06:24:35.823+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2022-12-28T06:24:35.824+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/circus/util.py", line 1126, in _run
[2022-12-28T06:24:35.824+0000] {subprocess.py:93} INFO -     val = self.callback()
[2022-12-28T06:24:35.824+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/circus/util.py", line 1038, in wrapper
[2022-12-28T06:24:35.825+0000] {subprocess.py:93} INFO -     raise ConflictError("arbiter is already running %s command"
[2022-12-28T06:24:35.825+0000] {subprocess.py:93} INFO - circus.exc.ConflictError: arbiter is already running arbiter_start_watchers command
[2022-12-28T06:24:36.465+0000] {subprocess.py:93} INFO - 2022-12-28T06:24:36+0000 [INFO] [cli] Starting production HTTP BentoServer from "bertopic_autopik_bento:latest" listening on http://0.0.0.0:7171 (Press CTRL+C to quit)
[2022-12-28T06:25:11.475+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2022-12-28T06:25:11.476+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 137, in import_service
[2022-12-28T06:25:11.477+0000] {subprocess.py:93} INFO -     module = importlib.import_module(module_name, package=working_dir)
[2022-12-28T06:25:11.477+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/importlib/__init__.py", line 127, in import_module
[2022-12-28T06:25:11.477+0000] {subprocess.py:93} INFO -     return _bootstrap._gcd_import(name[level:], package, level)
[2022-12-28T06:25:11.477+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
[2022-12-28T06:25:11.478+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
[2022-12-28T06:25:11.478+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 973, in _find_and_load_unlocked
[2022-12-28T06:25:11.479+0000] {subprocess.py:93} INFO - ModuleNotFoundError: No module named 'bertopic_autopik_bento'
[2022-12-28T06:25:11.479+0000] {subprocess.py:93} INFO - 
[2022-12-28T06:25:11.479+0000] {subprocess.py:93} INFO - During handling of the above exception, another exception occurred:
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO - 
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 359, in load
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO -     svc = import_service(
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/simple_di/__init__.py", line 139, in _
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO -     return func(*_inject_args(bind.args), **_inject_kwargs(bind.kwargs))
[2022-12-28T06:25:11.480+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 139, in import_service
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO -     raise ImportServiceError(f'Failed to import module "{module_name}": {e}')
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO - bentoml.exceptions.ImportServiceError: Failed to import module "bertopic_autopik_bento": No module named 'bertopic_autopik_bento'
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO - 
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO - During handling of the above exception, another exception occurred:
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO - 
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2022-12-28T06:25:11.481+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/runpy.py", line 194, in _run_module_as_main
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -     return _run_code(code, main_globals, None,
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/runpy.py", line 87, in _run_code
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -     exec(code, run_globals)
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml_cli/worker/http_api_server.py", line 180, in <module>
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -     main()  # pylint: disable=no-value-for-parameter
[2022-12-28T06:25:11.483+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/click/core.py", line 1130, in __call__
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -     return self.main(*args, **kwargs)
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/click/core.py", line 1055, in main
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -     rv = self.invoke(ctx)
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/click/core.py", line 1404, in invoke
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -     return ctx.invoke(self.callback, **ctx.params)
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/click/core.py", line 760, in invoke
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -     return __callback(*args, **kwargs)
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml_cli/worker/http_api_server.py", line 127, in main
[2022-12-28T06:25:11.484+0000] {subprocess.py:93} INFO -     svc = bentoml.load(bento_identifier, working_dir=working_dir, standalone_load=True)
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 368, in load
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -     svc = load_bento(bento_identifier, standalone_load=standalone_load)
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/simple_di/__init__.py", line 139, in _
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -     return func(*_inject_args(bind.args), **_inject_kwargs(bind.kwargs))
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 221, in load_bento
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -     return _load_bento(bento, standalone_load)
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 247, in _load_bento
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -     svc = import_service(
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/simple_di/__init__.py", line 139, in _
[2022-12-28T06:25:11.485+0000] {subprocess.py:93} INFO -     return func(*_inject_args(bind.args), **_inject_kwargs(bind.kwargs))
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bentoml/_internal/service/loader.py", line 137, in import_service
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -     module = importlib.import_module(module_name, package=working_dir)
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/importlib/__init__.py", line 127, in import_module
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -     return _bootstrap._gcd_import(name[level:], package, level)
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
[2022-12-28T06:25:11.486+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 991, in _find_and_load
[2022-12-28T06:25:11.489+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
[2022-12-28T06:25:11.489+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap_external>", line 843, in exec_module
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -   File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -   File "/root/bentoml/bentos/bertopic_autopik_bento/gedvo6egpcmd6asc/src/bento_service_auto_pik.py", line 67, in <module>
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -     model = BERTopic.load("/opt/***/dags/data/paraphrase-multilingual-MiniLM-L12-v2_40_20")
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/bertopic/_bertopic.py", line 2197, in load
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -     topic_model = joblib.load(file)
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/joblib/numpy_pickle.py", line 648, in load
[2022-12-28T06:25:11.490+0000] {subprocess.py:93} INFO -     obj = _unpickle(fobj)
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/joblib/numpy_pickle.py", line 577, in _unpickle
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -     obj = unpickler.load()
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/pickle.py", line 1212, in load
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -     dispatch[key[0]](self)
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.8/pickle.py", line 1589, in load_reduce
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -     stack[-1] = func(*args)
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/storage.py", line 240, in _load_from_bytes
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -     return torch.load(io.BytesIO(b))
[2022-12-28T06:25:11.491+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/serialization.py", line 795, in load
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -     return _legacy_load(opened_file, map_location, pickle_module, **pickle_load_args)
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/serialization.py", line 1012, in _legacy_load
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -     result = unpickler.load()
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/serialization.py", line 958, in persistent_load
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -     wrap_storage=restore_location(obj, location),
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/serialization.py", line 215, in default_restore_location
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -     result = fn(storage, location)
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -   File "/home/***/.local/lib/python3.8/site-packages/torch/serialization.py", line 185, in _cuda_deserialize
[2022-12-28T06:25:11.492+0000] {subprocess.py:93} INFO -     return torch.UntypedStorage(obj.nbytes(), device=torch.device(location))
[2022-12-28T06:25:11.493+0000] {subprocess.py:93} INFO - RuntimeError: CUDA error: all CUDA-capable devices are busy or unavailable
[2022-12-28T06:25:11.493+0000] {subprocess.py:93} INFO - CUDA kernel errors might be asynchronously reported at some other API call,so the stacktrace below might be incorrect.
[2022-12-28T06:25:11.493+0000] {subprocess.py:93} INFO - For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
[2022-12-28T06:25:46.542+0000] {subprocess.py:93} INFO - /bin/bash: line 2:  1049 Killed                  bentoml serve -p 7171 bertopic_autopik_bento:latest --production
[2022-12-28T06:27:39.093+0000] {local_task_job.py:87} ERROR - Received SIGTERM. Terminating subprocesses
[2022-12-28T06:27:39.099+0000] {process_utils.py:129} INFO - Sending Signals.SIGTERM to group 1026. PIDs of all processes in the group: [1047, 1026]
[2022-12-28T06:27:39.099+0000] {process_utils.py:84} INFO - Sending the signal Signals.SIGTERM to group 1026
[2022-12-28T06:27:39.100+0000] {taskinstance.py:1562} ERROR - Received SIGTERM. Terminating subprocesses.
[2022-12-28T06:27:39.100+0000] {subprocess.py:104} INFO - Sending SIGTERM signal to process group
[2022-12-28T06:27:39.126+0000] {taskinstance.py:1851} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/bash.py", line 187, in execute
    result = self.subprocess_hook.run_command(
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/hooks/subprocess.py", line 91, in run_command
    for raw_line in iter(self.sub_process.stdout.readline, b''):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 1564, in signal_handler
    raise AirflowException("Task received SIGTERM signal")
airflow.exceptions.AirflowException: Task received SIGTERM signal
[2022-12-28T06:27:39.135+0000] {taskinstance.py:1401} INFO - Marking task as FAILED. dag_id=bertopic_autopik_***, task_id=serve_bentoml, execution_date=20221228T061444, start_date=20221228T062354, end_date=20221228T062739
[2022-12-28T06:27:39.792+0000] {standard_task_runner.py:102} ERROR - Failed to execute job 25 for task serve_bentoml (Task received SIGTERM signal; 1026)
[2022-12-28T06:27:40.111+0000] {process_utils.py:79} INFO - Process psutil.Process(pid=1026, status='terminated', exitcode=1, started='06:23:53') (1026) terminated with exit code 1
[2022-12-28T06:27:40.115+0000] {process_utils.py:79} INFO - Process psutil.Process(pid=1047, status='terminated', started='06:24:05') (1047) terminated with exit code None
[2022-12-28T06:27:40.118+0000] {local_task_job.py:164} INFO - Task exited with return code 143
[2022-12-28T06:27:40.188+0000] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
